doctype 5
html
	head
		meta(http-equiv="content-type", content="text/html; charset=utf-8")
		meta(name="viewport", content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")
		meta(name="apple-mobile-web-app-capable", content="yes")
		meta(http-equiv="cache-control", content="no-cache")
		meta(http-equiv="X-UA-Compatible", content="IE=Edge,chrome=IE8")
		title= pageTitle
		link(rel="stylesheet", type="text/css", href="/style/normalize.css")
		link(rel="stylesheet", type="text/css", href="/style/fonts.css")
		link(rel="stylesheet", type="text/css", href="/style/style_common.css?appv=" + appVersion)
		script(type='text/javascript', src="js/jquery-1.7.2.min.js")
		script(type='text/javascript', src="js/flash_detect.js")
		script(type='text/javascript', src="js/Utils.js?appv=" + appVersion)
			
	body
		script(type='text/html', id="CamListTemplate").
			<div class='CamList' data-bind="style: {height: containerH()+'px'}, css: {scrolls: scrollActive()}">
				<div class='camListScroll up' data-bind="css: {noScroll: scrollTop()==0}, event: { mousedown: ScrollOnUp, touchstart: ScrollOnUp, mouseup: ScrollOff, touchend: ScrollOff }"></div>
				<div class='camListRowsWrapper' data-bind="style: {height: (containerH() - (scrollActive() ? 58 : 0))+'px'}, event: {mousewheel: OnWheel, DOMMouseScroll: OnWheel}">
					<div class='camListRows' data-bind="foreach: cams, style: {marginTop: scrollTop()+'px'}">
						<div class='CamListRow' data-bind="click: $parent.clickRow">
							<div class='CamIcon' data-bind="style: {backgroundImage: 'url('+icon+')'}"></div>
							<div class='CamContent'>
								<div class='CamName' data-bind="html: name"></div>.&nbsp;
								<div class='CamAddr' data-bind="text: address"></div>
								<div class='CamTools' data-bind="text: address"></div>
							</div>
						</div>
					</div>
				</div>
				<div class='camListScroll down' data-bind="css: {noScroll: scrollDownNoScroll()}, event: { mousedown: ScrollOnDown, touchstart: ScrollOnDown, mouseup: ScrollOff, touchend: ScrollOff }"></div>
			</div>
		div#main_loader
			div#cnt
				div#welcome_msg.
					Retro photo of humankind urbanization
				div#loading_pics
					div#l1
					div#l2
					div#l3
					div#l4
					div#l5
					div#l6
					div#l7
					div#l8
					div#l9
					div#l10
				div#bar
					div#bar_fill
				div#info_msg.
					loading, please wait
				div#percent
			div.helper
		script(type='text/javascript')
			var main_loader = document.getElementById('main_loader'),
				allPercent = 15, //15% остается на выполнение app()
				onePercentW = ($('#bar').width())/100,
				l_pics = Array.prototype.splice.call(document.querySelector('#loading_pics').children, 0, 10).sort(function sRand() { return Math.random() > 0.5 ? 1 : -1;}),
				current_percent = 0,
				main_loader_percent = document.getElementById('percent'),
				main_loader_bar_fill = document.getElementById('bar_fill');
				
			function LoaderIncrement(delta, finish){
				delta = (allPercent > 100 ? Math.floor(delta*100/allPercent) : Math.floor(delta*allPercent/100));
				current_percent += delta;
				if (current_percent >= 100 || finish){
					current_percent = 100;
					main_loader.classList.add('green');
				}
				var dec = Math.floor(current_percent/10);
				for(var i=1; i<=dec; i++) l_pics[i-1].classList.add('finish');
				main_loader_percent.innerHTML = current_percent + '%';
				main_loader_bar_fill.style.width = current_percent*onePercentW + 'px';
			}
			LoaderIncrement(0);
			function removeLoader(){
				main_loader.style.display = 'none';
				main_loader = main_loader_percent = main_loader_bar_fill = null;
			}
		div#main.
			<div id="map">
			</div>
			
			<div id='top_panel_fringe' class='fringe'>
				<div id='top_panel' class='inner_bord'>
					<div id='appName'>Retro photo of mankind's habitat</div>
					<div id='panelTools'>
						<div
							id='toProfile' class='labledIco' onclick='FormOpen("#reg_fringe")' data-bind='style:{display: loggedIn()?"":"none"}'>
							<div class='ico'></div>
							<div class='text' data-bind="text: profile"></div>
						</div><div
							id='toRegister' class='labledIco' onclick='FormOpen("#reg_fringe")' data-bind='style:{display: loggedIn() || !registrationAllowed() ? "none":""}'>
							<div class='ico'></div>
							<div class='text' data-bind="text: register"></div>
						</div><div
							id='toLogIn' class='labledIco strokeBefore' onclick='FormOpen("#login_fringe")' data-bind='style:{display: loggedIn()?"none":""}'>
							<div class='text' data-bind="text: login"></div>
							<div class='ico'></div>
						</div><div
							id='toLogOut' class='labledIco strokeBefore' onclick='Logout()' data-bind='style:{display: loggedIn()?"":"none"}'>
							<div class='text' data-bind="text: logout"></div>
							<div class='ico'></div>
						</div>
					</div>
				</div>
			</div>
			<div id='logo_fringe' class='fringe'>
				<div id='logo' class='inner_bord'>
				</div>
			</div>
			
			
			<div id='nav_panel'>
				<div id='moystick'>
					<div id='mup' onclick="mapUp()"></div>
					<div id='mright' onclick="mapRight()"></div>
					<div id='mdown' onclick="mapDown()"></div>
					<div id='mleft' onclick="mapLeft()"></div>
					<div id='mhome' onclick="setMapDefCenter(true)"></div>
				</div>
				<div id='zoomin_fringe' class='fringe btn inout' onclick="ChangeZoom(1)"><div id='zoomin' class='inner_bord'></div></div>
				<div id='zoomout_fringe' class='fringe btn inout' onclick="ChangeZoom(-1)"><div id='zoomout' class='inner_bord'></div></div>
				<div id='nav_stick_fringe' class='fringe btn'><div id='nav_stick' class='inner_bord'></div></div>
				<div id='nav_slider_area'>
				</div>
			</div>

			<div id='layers_fringe' class='fringe gradientBack'>
				<div id='layers_panel' class='inner_bord'>
					<div id='current' onclick="this.parentNode.classList.toggle('open'); document.getElementById('filter_fringe').classList.toggle('move'); document.getElementById('search_fringe').classList.toggle('moveByLayers');"></div>
					<div id='systems'></div>
				</div>
			</div>

			<div id='search_fringe' class='fringe gradientBack'>
				<div id='search_panel' class='inner_bord' data-bind="css: {open: open()==true, fill: query().length>0 }">
					<div id='search_in'>
						<div id='searchArrow' data-bind="click: toggleOpen"><div></div></div>
						<input id='SearchInput' placeholder="Поиск.." type="text" data-bind="value: query, valueUpdate: 'keyup'" autocomplete="off">
						<div id='searchClear' data-bind="click: clear"></div>
					</div>
					<div id='search_options'>
						<div id='searchWithFilter' data-bind="css: {check: respectFilter()==true}, click: toggleFilter"><div class='check_box'></div><div class='check_name'>С учетом фильтра</div></div>
						<div id='searchApplyMap' data-bind="css: {check: applyMap()==true}, click: toggleApplyMap"><div class='check_box'></div><div class='check_name'>Отображать на карте</div></div>
						<div id='searchResultCount'>Результатов: <span data-bind="text: resultCount"></span></div>
					</div>
					<div id='search_out' data-bind="template: {name:'CamListTemplate', data: CamList, afterRender: CamList.AfterTemplateRender}, style: {height: CamList.containerH()+'px'}">
					</div>
				</div>
			</div>
			<div id='curtain'></div>
			
			<div id='login_fringe' class='fringe form'>
				<div id="login_body" class='inner_bord'>
					<div id='login_head' class='head'>Authorization</div>
					<form action='' autocomplete="on"  method='POST' id='loginForm' name='loginForm' onSubmit="return Login(this);">
						<div class='label icon-user'>Username:</div>
						<div class='label clickable' onclick='LoginActivateSwap("#reg_fringe")'>Registration</div>
						<br />
						<input id='login_user' autocomplete="on" class='initFocus' type="text" required="required" title="input login" placeholder="Enter username or e-mail" name="login" />
						<div class='label icon-lock'>Password:</div>
						<div class='label clickable' onclick='LoginActivateSwap("#recall_fringe")'>Recover password</div>
						<br />
						<input id='login_pass' type="password" required="required" title="input password" placeholder="Enter password" name="pass">
						<div class='label' style='margin: 0 0 5px 15px;'>Remember me</div><div id='remember_check' class='checked' onclick='LoginRememberCheck(this)'></div><br/>
						<input type="submit" value="Sign in" />
						<input type="button" onclick='FormClose()' value="Cancel" />
					</form>
					<div id="login_wait" class='wait'>Authorizing..</div>
					<div id="login_mess" class='mess'><div></div></div>
				</div>
			</div>

			<div id='reg_fringe' class='fringe form'>
				<div id="reg_body" class='inner_bord'>
					<div id='reg_head' class='head'>Registration</div>
					<form action='' autocomplete="off" method='POST' id='regForm' name='regForm' onSubmit="return Register(this);">
						<div class='label icon-user'>User name:</div><div class='label clickable' onclick='LoginActivateSwap("#login_fringe")'>Authorization</div><br />
						<input id='reg_user' autocomplete="off" class='initFocus' type="text" required="required" title="input login" placeholder="User" name="login">
						<div class='label icon-envelope'>E-mail:</div>
						<input id='reg_email' type="email" autocomplete="on" required="required" title="input email" placeholder="email" name="email">
						<div class='label icon-lock'>Password:</div><br />
						<input id='reg_pass' type="password" required="required" title="input password" placeholder="Enter password" name="pass">
						<div class='label icon-lock'>Repeat password:</div><br />
						<input id='reg_pass2' type="password" required="required" title="input password" placeholder="Enter password" name="pass2">
						<input type="submit" value="Register">
						<input type="button" onclick='FormClose()' value="Cancel">
					</form>
					<div id="reg_wait" class='wait'>Sending data..</div>
					<div id="reg_mess" class='mess'><div></div></div>
				</div>
			</div>

			<div id='recall_fringe' class='fringe form'>
				<div id="recall_body" class='inner_bord'>
					<div id='recall_head' class='head'>Recover password</div>
					<form action='' autocomplete="off" method='POST' id='recallForm' name='recallForm' onSubmit="return RecallAjax(this);">
						<div class='label icon-envelope'>Login or e-mail:</div><div class='label clickable' onclick='LoginActivateSwap("#login_fringe")'>Authorization</div><br />
						<input id='recall_email' autocomplete="off" class='initFocus' type="text" required="required" title="Input login or e-mail" placeholder="Enter login or e-mail" name="login">
						<input type="submit" value="Send">
						<input type="button" onclick='FormClose()' value="Cancel">
					</form>
					<div id="recall_wait" class='wait'>Sending..</div>
					<div id="recall_mess" class='mess'><div></div></div>
				</div>
			</div>
		
		script(type='text/javascript', src="/socket.io/socket.io.js")
		script(type='text/javascript', src="js/appLoader.js?appv=" + appVersion)