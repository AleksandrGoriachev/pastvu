| {{##def.commentAnonym:
.c(id="c{{=c.cid}}", class="l{{=c.level}}")
	a.hrefava(href="{{='/u/'+c.user.login}}"): img.cava(src="{{=c.user.avatar}}")
	.cbody
		.chead
			a.author(class="{{?c.user.online}}online{{?}}", href="{{='/u/'+c.user.login}}") {{=c.user.disp}}
			| {{?c.user.rnks}}
			.ranks {{=c.user.rnks}}
			| {{?}}
			| {{?c.frag}}
			.dotDelimeter ·
			a.frag(href="{{='?hl=frag-'+c.cid}}")
				span.glyphicon.glyphicon-picture
				|  Комментируемый фрагмент
			| {{?}}
			.dotDelimeter ·
			a.stamp(href="{{='?hl=comment-'+c.cid}}") {{=it.fDate(new Date(c.stamp))}}
			| {{?c.lastChanged}}
			.dotDelimeter ·
			.changed(title="Показать историю изменений") {{='Изменен '+it.fDateIn(new Date(c.lastChanged))}}
			| {{?}}
		.ctext {{=c.txt}}
| #}}
| {{##def.commentCanReply:
.c(id="c{{=c.cid}}", class="l{{=c.level}}{{?c.isnew}} isnew{{?}}")
	a.hrefava(href="{{='/u/'+c.user.login}}"): img.cava(src="{{=c.user.avatar}}")
	.cbody
		.chead
			a.author(class="{{?c.user.online}}online{{?}}", href="{{='/u/'+c.user.login}}") {{=c.user.disp}}
			| {{?c.user.rnks}}
			.ranks {{=c.user.rnks}}
			| {{?}}
			| {{?c.frag}}
			.dotDelimeter ·
			a.frag(href="{{='?hl=frag-'+c.cid}}")
				span.glyphicon.glyphicon-picture
				|  Комментируемый фрагмент
			| {{?}}
			.dotDelimeter ·
			a.stamp(href="{{='?hl=comment-'+c.cid}}") {{=it.fDate(new Date(c.stamp))}}
			| {{?c.lastChanged}}
			.dotDelimeter ·
			.changed(title="Показать историю изменений") {{='Изменен '+it.fDateIn(new Date(c.lastChanged))}}
			| {{?}}
		.ctext {{=c.txt}}
		.cacts
			span.cact.reply Ответить
			| {{?c.can.edit}}
			.dotDelimeter ·
			span.cact.edit Редактировать
			| {{?}}
			| {{?c.can.del}}
			.dotDelimeter ·
			span.cact.remove Удалить
			| {{?}}
| #}}

| {{ if ({{#def.mode === 'anonym'}}) { }}
| {{~it.comments :c:index}}
| {{#def.commentAnonym}}
| {{~}}

| {{ } else if ({{#def.mode === 'reply'}}) { }}
| {{~it.comments :c:index}}
| {{#def.commentCanReply}}
| {{~}}
| {{ } }}

