.gallery(data-bind="with: repository[M!M]")
	.thumbs(data-bind="style: {width: panelW()}")
		.row.rowoffset
			.col-xs-12.topcol
				//ko if: topTitle()
				.pageHeader(data-bind="text: topTitle()")
				// /ko

		.row.rowoffset
			.col-xs-6.col-md-3.col-lg-4.topcol(data-bind="css: {invisible: !loadedFirst()}")
				.filter
					label.checkbox-inline.title
						span.glyphicon.glyphicon-filter
						input.titlechk(type="checkbox")
						| Фильтр
					.fvals
						.row.regions
							.filterName Регионы:
							.filterVars
								//ko if: !filter.disp.r().length
								span.region
									span.glyphicon.glyphicon-globe
									|  Весь мир
								// /ko
								//ko foreach: filter.disp.r
								span.region
									span(data-bind="text: $data.title_local")
								// /ko
								span.regionEdit(data-bind="click: regionSelect")
									span.glyphicon.glyphicon-pencil
									| Изменить
						.more
						.geovars
						//ko if: filter.can.s()
						.row.svars
							.filterName Статусы:
							.filterVars(data-bind="foreach: filter.available.s")
								label.checkbox-inline.s
									input(type="checkbox", data-bind="attr: {value: $data.cid}, checked: $parent.filter.disp.s")
									span(data-bind="text: $data.title")
						// /ko
			.col-xs-6.col-md-3.col-md-push-6.col-lg-4.col-lg-push-4.topcol.switch(data-bind="css: {invisible: !loadedFirst()}")
				span.brief(data-bind="text: briefText")
				//ko if: photos().length
				.btn-group
					button.btn.btn-primary(title="Постранично", data-bind="click: function () {feedSelect(false)}, css: {active: !feed()}")
						span.glyphicon.glyphicon-book
					button.btn.btn-primary(title="Лента", data-bind="click: function () {feedSelect(true)}, css: {active: feed()}")
						span.glyphicon.glyphicon-th-list
				// /ko
			.col-xs-12.col-md-6.col-md-pull-3.col-lg-4.col-lg-pull-4.pag(data-bind="css: {loading: !feed() && loading(), hasPag: paginationShow()}")
				//ko if: paginationShow()
				//ko template: {name: 'photoPagerTpl'}
				// /ko
				// /ko

		//ko if: u && canAdd()
		a.photoPreview.withTitle.fringe.addPhoto(href="/photoUpload")
			img.img(src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7", data-bind="style: {width: w, height: h}")
			.plusPhoto
			.desc Добавить фото..
		// /ko
		//ko foreach: photos
		.photoPreview.withStatus.withTitle.fringe(data-bind="attr: {title: title}, css: ($parent.feed() ? 'trans ' : '') + 's' + $data.s")
			a.photoBox(data-bind="attr: {href: '/p/' + cid, target: $parent.feed() ? '_blank' : '_self'}")
				img.img(data-bind="attr: {src: sfile, alt: title}, event: {load: $parent.onPreviewLoad, error: $parent.onPreviewErr}, style: {width: $parent.w, height: $parent.h}")
				.curtain
				//ko if: $data.s!==5
				.status.fringe(data-bind="attr: {title: s<2 ? (s===1 ? 'Новая. Ждет подтверждения' : 'Новая фотография') : (s===7 ? 'Фотография неактивна' : 'Фотография удалена')}")
					span.glyphicon(data-bind="css: {'glyphicon-asterisk': s===0, 'glyphicon-flag': s===1, 'glyphicon-lock': s===7, 'glyphicon-trash': s===9}")
				// /ko
			a.photoTitle(data-bind="text: title, attr: {href: '/p/' + cid, target: $parent.feed() ? '_blank' : '_self'}")
			//ko if: $data.ccount
			a.comm(data-bind="html: $data.ccount + ($data.ccount_new ? '<span class=\"cnew\"> +' + $data.ccount_new + '</span>' : ''), attr: {href: '/p/' + cid + '?hl=comments', target: $parent.feed() ? '_blank' : '_self'}", title="Комментарии")
			// /ko
		// /ko
		//ko if: feed()
		.photoPreview.withTitle.loadingPhoto(data-bind="style: {visibility: loading() ? 'visible' : 'hidden', width: w, height: h}")
			.loadPhoto Загрузка
		// /ko
		.rowoffset.pag(data-bind="style: {visibility: paginationShow() ? 'visible' : 'hidden'}, template: {name: 'photoPagerTpl'}")
	script(id="photoPagerTpl", type="text/html")
		ul.pagination
			li.edge(data-bind="css: {disabled: page() === 1}"): a(data-bind="attr: {href: pageUrl() + pageQuery()}", title="Первая страница") &laquo;&laquo;
			li.edge(data-bind="css: {disabled: !pageHasPrev()}"): a(data-bind="attr: {href: pageUrl() + (page() > 1 ? '/' + (page() - 1) : '')+ pageQuery()}", title="Предыдущая страница") &laquo;
			//ko foreach: pages
			li(data-bind="css: {active: $data === $parent.page()}"): a(data-bind="attr: {href: $parent.pageUrl() + '/' + $data + $parent.pageQuery()}, text: $data")
			// /ko
			li.edge(data-bind="css: {disabled: !pageHasNext()}"): a(data-bind="attr: {href: pageUrl() + '/' + (page() + 1) + pageQuery()}", title="Следующая страница") &raquo;
			li.edge(data-bind="css: {disabled: page() === pageLast()}"): a(data-bind="attr: {href: pageUrl() + '/' + pageLast() + pageQuery()}", title="Последняя страница") &raquo;&raquo;